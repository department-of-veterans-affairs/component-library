@forward 'uswds-theme';

@use 'uswds-core/src/styles/mixins/utility-builder' as *;
@use 'uswds-core/src/styles/functions' as *;
@use '../utilities' as *;

$utilities-package: map-collect(
  $u-bg-color,
  $u-border,
  $u-color,
  $u-display,
  $u-flex-grid,
  $u-flexbox,
  $u-font,
  $u-height,
  $u-line-height,
  $u-margin,
  $u-measure,
  $u-padding,
  $u-position,
  $u-text-align,
  $u-text-decoration,
  $u-visibility,
  $u-width
);

// Generate all utility classes from USWDS function
@include render-utilities-in($utilities-package);

// Generate medium screen breakpoint utility classes.
$medium-screen-breakpoint: 768px;
$breakpoint-class-name: 'medium-screen';

@mixin generate-utilities-from-deep-map($collection) {
  @each $property, $property-map in $collection { 
    $u-base: map-get($property-map, base);
    $u-values: map-get($property-map, values);
    $u-property: map-get($property-map, property);
    $u-modifiers: map-get($property-map, modifiers);

    @if $u-modifiers {
      @each $modifier, $modifier-value in $u-modifiers {
        @each $name, $value in $u-values {
          .#{$breakpoint-class-name}\:#{$u-base}#{$modifier-value}-#{$name} {
            @if $modifier == 'noModifier' {
              #{$u-property}: #{$value};
            } @else {
              #{$u-property}#{$modifier-value}: #{$value};
            }
          }
        }
      }
    }

    @each $name, $value in $u-values {
      .#{$breakpoint-class-name}\:#{$u-base}-#{$name} {
        #{$u-property}: #{$value};
      }
    }
  }
}

@media all and (min-width: $medium-screen-breakpoint) {
  // u-border
  @include generate-utilities-from-deep-map($u-border);

  // display
  @include generate-utilities-from-deep-map($u-display);

  // flexbox
  @include generate-utilities-from-deep-map($u-flexbox);

  // TODO: flex-grid
  // @debug $u-flex-grid;

  // u-font
  @include generate-utilities-from-deep-map($u-font);

  // u-height
  @include generate-utilities-from-deep-map($u-height);

  // u-line-height
  @include generate-utilities-from-deep-map($u-line-height);

  // TODO: u-margin
  // @debug $u-margin;

  // u-measure,
  @include generate-utilities-from-deep-map($u-measure);

  // u-padding
  @include generate-utilities-from-deep-map($u-padding);

  // u-position
  @include generate-utilities-from-deep-map($u-position);

  // u-text-align
  @include generate-utilities-from-deep-map($u-text-align);

  // u-text-decoration
  @include generate-utilities-from-deep-map($u-text-decoration);

  // u-visibility
  @include generate-utilities-from-deep-map($u-visibility);

  // u-width
  @include generate-utilities-from-deep-map($u-width);
}
